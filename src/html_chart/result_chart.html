<html>

<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script type="text/javascript">

        // create websocket
        var socket = io.connect('http://localhost:3000');
        // display chart
        socket.on('onlinenums', function (d) {
            // load data
            let dataList = d;

            dataList.shift()

            google.charts.load('current', { 'packages': ['line'] });
            google.charts.setOnLoadCallback((drawChart));


            function drawChart() {
                // user
                let dl = getCol(dataList, 0, 1)
                createChart('User Chart','chart_user', dl)

                // tps
                dl = getCol(dataList, 0, 2)
                createChart('TPS Chart','chart_tps', dl)

                // response time
                dl = getCol(dataList, 0, 3)
                createChart('Response Time Chart','chart_rps', dl)

                // OK tx
                dl = getCol(dataList, 0, 4)
                createChart('OK Transaction Chart','chart_OK', dl)

                // KO tx
                dl = getCol(dataList, 0, 5)
                createChart('Failed Transaction Chart','chart_KO', dl)

                // block time
                dl = getCol(dataList, 0, 6)
                createChart('Block Time Chart','chart_block_time', dl)

                // tx in block 
                dl = getCol(dataList, 0, 7)
                createChart('Block Transactions Chart','chart_block_tx', dl)
            }

            function createChart(titleName, chartId, dl) {
                
                var data = new google.visualization.DataTable();

                data.addColumn('string', 'Excution Time');
                data.addColumn('number', titleName);

                // dl.shift();

                // dl.forEach(element => {
                //     element[0] = element[0].toString()
                // });
                // // let t = [];
                

                data.addRows(dl);

                let options = {
                    title: titleName,
                    width: window.innerWidth - 50,
                    height: 500,
                    curveType: 'function',
                    legend: { position: 'bottom' }
                };

                var chart = new google.charts.Line(document.getElementById(chartId));
                chart.draw(data, google.charts.Line.convertOptions(options));
            }


            function createChart2(titleName, chartId, dl) {
                
                let data = google.visualization.arrayToDataTable(dl);

                let options = {
                    title: titleName,
                    width: window.innerWidth - 50,
                    height: 500,
                    curveType: 'function',
                    legend: { position: 'bottom' }
                };

                var chart = new google.charts.Line(document.getElementById(chartId));
                chart.draw(data, google.charts.Line.convertOptions(options));
            }

            // get two specified columes from a 2-d array
            function getCol(matrix, col1, col2) {
                var column = [];
                for (var i = 0; i < matrix.length; i++) {
                    column.push([matrix[i][col1], matrix[i][col2]]);
                }
                return column;
            }

        });
    </script>
</head>

<body>
    <div id="chart_user" ></div>
    <br/>
    <br/>
    <div id="chart_tps" ></div>
    <br/>
    <br/>
    <div id="chart_rps" ></div>
    <br/>
    <br/>
    <div id="chart_OK" ></div>
    <br/>
    <br/>
    <div id="chart_KO" ></div>
    <br/>
    <br/>
    <div id="chart_block_time" ></div>
    <br/>
    <br/>
    <div id="chart_block_tx" ></div>
    <br/>
    <br/>
</body>

</html>